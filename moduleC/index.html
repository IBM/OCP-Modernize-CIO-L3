
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3">
      
      
        <meta name="author" content="Christopher Bienko (cdbienko@us.ibm.com)">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.1">
    
    
      
        <title>Module C - Programmatically manipulating OpenShift - Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-c-programmatically-create-scale-upgrade-and-rollback-an-openshift-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3" class="md-header__button md-logo" aria-label="Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Module C - Programmatically manipulating OpenShift
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3" class="md-nav__button md-logo" aria-label="Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Modernizing Business for Hybrid Cloud with IBM Power and Red Hat OpenShift (CIO Persona) for Technical Sales Level 3
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        Evaluation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../moduleA/" class="md-nav__link">
        Module A - Red Hat OpenShift S2I and GitHub webhooks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../moduleB/" class="md-nav__link">
        Module B - Working graphically with OpenShift
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Module C - Programmatically manipulating OpenShift
      </a>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="module-c-programmatically-create-scale-upgrade-and-rollback-an-openshift-application"><strong>Module C</strong>: Programmatically create, scale, upgrade, and rollback an OpenShift application</h1>
<hr />
<div class="admonition note">
<p class="admonition-title">COMMAND LINE ACCESS</p>
<p>In the module ahead, you will be required to establish connections over SSH to remote infrastructure endpoints. It is recommended that users do so via <strong>Terminal</strong> (Mac) or <strong>PuTTY</strong> (Windows). For detailed instructions on how to connect with PuTTY, or if you are using a Windows machine, <a href="https://ibm.box.com/s/d71tn63hutdxrjwh21qdzralrsxlcspe" target="_blank">reference the linked material</a>.</p>
</div>
<p>The following steps will replicate the work done previously in <em>Module B</em>, but this time using a programmatic (command-line) driven approach, rather than Openshift's web-based graphical user interface.</p>
<p>The first step will be the creation of an application within OpenShift Container Platform (OCP) from an existing image hosted on the <strong>Red Hat Quay.io</strong> repository. In this module, you will be performing these operations programmatically using remote connections over SSH (via Terminal or Putty). The numbering of these instructions continues from <em>Module B</em>.</p>
<hr />
<ol start="40">
<li>If you are not logged into the Red Hat OpenShift cluster already, do so now. You will need to access parts of the OpenShift dashboard briefly before you can get to work over an SSH connection.</li>
</ol>
<hr />
<ol start="41">
<li>Set the perspective viewer to <strong>Administrator</strong> from the drop-down in the top-left corner.</li>
</ol>
<hr />
<ol start="42">
<li>
<p>In the top-right corner of the dashboard, click the <strong>cecuser</strong> button (the account name you are currently logged in under) to open a drop-down menu.</p>
<ul>
<li>Click the <strong>Copy login command</strong> option from the menu. You will be asked to login using <code>htpasswd</code> a second time.</li>
<li>Your browser will open a new window which is mostly white, except for a <strong>Display Token</strong> link in the top-left — <strong>click</strong> this link to generate a login string.</li>
</ul>
<p></br>
<img alt="" loading="lazy" src="../_attachments/66.png" width="600" /></p>
</li>
</ol>
<hr />
<ol start="43">
<li>
<p>OpenShift will generate a <em>limited-time API token</em> for logging in to the OCP cluster remotely.</p>
<p><strong>Copy</strong> the complete value under the <em>Log in with this token</em> string (<code>oc login ==token...</code>) and save it to a notepad, as you will be making use of this API token shortly.</p>
<p></br>
<img alt="" loading="lazy" src="../_attachments/67.png" width="600" /></p>
</li>
</ol>
<hr />
<ol start="44">
<li>
<p>Return to the <strong>My Reservations</strong> tab of IBM Technology Zone and drill down into your OpenShift reservation for additional <strong>Environment</strong> details.</p>
<ul>
<li>Locate the <strong>User Private SSH Key</strong> variable and copy it to clipboard using the shortcut.</li>
<li><strong>Save</strong> the complete key value (including the <code>BEGIN</code> and <code>END</code> lines) to a new notepad file named <code>privatekey.pem</code> on local Desktop so that it can be quickly referenced later.</li>
</ul>
<p></br>
<img alt="" loading="lazy" src="../_attachments/65.png" width="600" /></p>
</li>
</ol>
<hr />
<ol start="45">
<li>Open a <strong>Terminal</strong> console (or PuTTY) on your local machine and navigate to Desktop (or the directory you saved the <code>.pem</code> file to) with the following command:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span> Desktop
</code></pre></div>
<hr />
<ol start="46">
<li>Execute the following instruction to set the appropriate access privileges on the <code>.pem</code> file:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>chmod <span class="m">600</span> privatekey.pem
</code></pre></div>
<hr />
<ol start="47">
<li>Now add the private key to the keychain of your local machine. If you are running on a Mac, this instruction can be invoked using the following:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>ssh-add --apple-use-keychain privatekey.pem
</code></pre></div>
<hr />
<ol start="48">
<li>Return to the ITZ <strong>My Reservations</strong> summary for the OCP environment once again for <strong>Environment</strong> details. Locate ahd copy the value of the <strong>Bastion Public IP Address</strong> to your clipboard. It should be something similar to:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>169.54.113.90
</code></pre></div>
<p>Retain this value for your records as you will need it again later.</p>
<hr />
<ol start="49">
<li>With your Terminal window still open and in the same directory as your private key file (<code>~/Desktop</code>), execute the following after substituting in the address from Step 48:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ssh cecuser@address-from-step-48
</code></pre></div>
<p>When logging in, you may receive a prompt asking whether to <em>“Use insecure connections?”</em> — respond with <code>y</code> and hit the <code>Return</code> key to continue.</p>
<p><img alt="" loading="lazy" src="../_attachments/68.png" width="600" /></p>
<hr />
<ol start="50">
<li>
<p>You are now connected to the <em>PowerVS bastion host</em>. Next, you need to login to the OCP cluster running on this infrastructure.</p>
<p>To do so, make use of the <em>API login token</em> generated earlier in Step 43. <strong>Paste</strong> that string into the Terminal window and execute.</p>
</li>
</ol>
<details class="warning">
<summary>LOGIN FAILED</summary>
<p>Remember to use your <strong>own</strong> unique API login token. It should look similar to <code>oc login --token=sha256~qE1YW2_2xSr12U_DJtryPXy6wAeTTwpHhGvJyxoL8v4 --server=https://api.itzpvs-212921.cecc.ihost.com:6443</code>.</p>
<p>If the login fails, try replacing <code>api.cecc-251990.cecc.ihost.com</code> with <code>localhost</code> instead, and try again.</p>
<p>You might be prompted once again to <em>"Use insecure connection (y/n)?"</em> — respond with <code>y</code>. After authenticating, the Terminal will now be remotely logged into the OpenShift on PowerVS cluster and ready for deploying applications into containers.</p>
<p><img alt="" loading="lazy" src="../_attachments/69.png" width="600" /></p>
</details>
<hr />
<ol start="51">
<li>With the Terminal window now logged into OCP, execute the following to create a new <em>Project</em> (in effect the same thing you did in Module B through the web graphical interface):</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>oc new-project pyflask-project
</code></pre></div>
<p><img alt="" loading="lazy" src="../_attachments/70.png" width="600" /></p>
<hr />
<ol start="52">
<li>Create a new deployment resource using the <em>Quay.io</em> image in the <code>pyFlask</code> project defined just a moment ago:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>oc create deployment mypyflask --image<span class="o">=</span>quay.io/dpkshetty/pyflask:v1
</code></pre></div>
<details class="note">
<summary>CHECK DEPLOYMENT PROGRESS GRAPHICALLY</summary>
<p>You can inspect the OpenShift cluster using the Web graphical user interface to verify that the application deployment is underway.</p>
<p>Return to the OpenShift dashboard and switch to the <strong>Administrator</strong> perspective. Then click <strong>Topology</strong>.</p>
<p>Here you can view the pod deployment which is underway. It will take several moments for the pod to be initialized and brought to a <em>Running</em> state.</p>
<p>Click the center of the deployment (the round icon on the <em>Topology</em> page) to check the changing status of the pod. Make sure that your <code>pyflask-project</code> is selected under <em>Project</em> (top-left corner), otherwise the Topology space may appear as empty.</p>
</details>
<hr />
<ol start="53">
<li>
<p>The deployment instruction you just issued to the cluster will generate a corresponding <em>pod</em> (containerized application) that will be deployed to into a <em>Running</em> (live) state.</p>
<p>Execute the following instruction within Terminal to list all of the running pods available within your <em>namespace</em>:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>oc get pods
</code></pre></div>
<hr />
<ol start="54">
<li>Next, you need to expose the deployment’s <code>8080</code> port so that a route to the application can be created:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>oc expose deployment mypyflask --port<span class="o">=</span><span class="m">8080</span> --type<span class="o">=</span>NodePort
</code></pre></div>
<hr />
<ol start="55">
<li>Execute the following command to view the service:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>oc get service
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">RECORD THIS VALUE</p>
<p>Record the value under the <code>EXTERNAL-IP</code> field for your records.</p>
</div>
<hr />
<ol start="56">
<li>
<p>In order to make the exposed service accessible externally (to the public), you must define a <em>public router</em>. To do so, return to the OpenShift cluster web dashboard and switch to the <strong>Administrator</strong> perspective.</p>
<ul>
<li>From the menus on the left side, drill down into <strong>Networking</strong> &gt; <strong>Routes</strong> and then <strong>Create Route</strong> (blue icon in the top-right corner).</li>
<li>Click the <strong>Project:</strong> drop-down menu at the top of the page and ensure that the value is set to <code>pyflask-project</code> before continuing with defining the new <em>Route</em>; otherwise, the <em>Service</em> created in Step 52 will not display in the configuration tool on Step 57.</li>
</ul>
</li>
</ol>
<hr />
<ol start="57">
<li>
<p>Define a new <strong>Route</strong> with the following parameters:</p>
<ul>
<li><em>Name</em>: <code>mypyflask</code></li>
<li><em>Service</em>: select the <code>mypyflask</code> service from Step 52</li>
<li><em>Target Port</em>: <code>8080-&gt;8080 (TCP)</code></li>
<li><em>Secure Route</em>: <code>enabled</code></li>
<li><em>TLS Termination</em>: <code>Edge</code></li>
<li><em>Insecure Traffic</em>: <code>None</code></li>
</ul>
</li>
</ol>
<hr />
<ol start="58">
<li>When satisfied, click <strong>Create</strong>.</li>
</ol>
<hr />
<ol start="59">
<li>
<p>Once the route has been defined and created, your browser will redirect to the Route Details panel. Here you will find additional configuration and health check details about the status of your route.</p>
<p>Click the <em>URL</em> below the <em>Location</em> section to view a live deployment of the <code>mypyflask</code> app.</p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">RECORD THIS VALUE</p>
<p>Record the output printed to screen from the live <code>mypyflask</code> application.</p>
</div>
<hr />
<p>Now that you have successfully deployed the application using an existing <em>Quay.io</em> image, try scaling and rolling back the application. The creation of multiple replicas of a pod will help Amy and her team to ensure that their application’s deployment always has the available capacity (and resources) to meet the need of any increased demand for the application within the company. </p>
<ol start="60">
<li>Returning to the Terminal console, execute the following command to increase the capacity of the pod from a single (<code>1</code>) instance up to <code>5</code> instances:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>oc scale --replicas<span class="o">=</span><span class="m">5</span> deployment/mypyflask
</code></pre></div>
<hr />
<ol start="61">
<li>Check the status of the deployment:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>oc rollout status deployment mypyflask
</code></pre></div>
<hr />
<ol start="62">
<li>Verify that there are now <code>5</code> pod instances running:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>oc get pods -n pyflask-project
</code></pre></div>
<hr />
<p>Amy’s team will next want to perform a rolling update to the application, thereby deploying it to a new container image. The <em>“rolling” update</em> capabilities of OpenShift make it possible for her team to update the running image and perform an <em>“undo” operation</em> if a problem is later discovered (during or after the update has been performed).</p>
<p>Showcase this by updating the application from <code>v1</code> to <code>v2</code> with the following steps.</p>
<hr />
<ol start="63">
<li>Update the application by executing:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>oc <span class="nb">set</span> image deployment/mypyflask <span class="nv">pyflask</span><span class="o">=</span>quay.io/dpkshetty/pyflask:v2
</code></pre></div>
<hr />
<ol start="64">
<li>Check the status of the rollout:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>oc rollout status deployment/mypyflask
</code></pre></div>
<hr />
<ol start="65">
<li>Retrieve a list of newly-launched pods with the <code>v2</code> image:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>oc get pods -n pyflask-project
</code></pre></div>
<hr />
<ol start="66">
<li>Further inspect the details of any of the five pods retrieved in Step 65 and use the following command to confirm that the pod is using the <code>v2</code> application image:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>oc describe pod &lt;pod-name&gt;
</code></pre></div>
<p>Replace <code>&lt;pod-name&gt;</code> with the value in Step 65. Do not include the <code>&lt; &gt;</code> braces when executing the modified instruction.</p>
<div class="admonition warning">
<p class="admonition-title">RECORD THIS VALUE</p>
<p>Record the value to the right of <em>Image</em> under the <em>Containers</em> section.</p>
</div>
<p>Notice that the service and router objects remain unchanged, despite having updated the underlying <em>Quay.io</em> image version of the running pod.</p>
<hr />
<ol start="67">
<li>
<p>Return to the <strong>Route Details</strong> panel (Step 59) and once again click the <em>URL</em> under the <em>Location</em> category. This will launch a new browser window where the <code>v2</code> update of <code>mypyflask</code> will be live and accessible.</p>
<p>Take note of the updated message printed to screen.</p>
</li>
</ol>
<hr />
<p>When performing an application rollback, Amy’s team is able to inspect references to both old replicas and new ones. In the case of the <code>mypyflask</code> application, you should expect to see old replicas of the original 5 pods deployed earlier when you scaled the application.</p>
<p>The new replicas will be generated as a result of deploying 5 newly-created pods with the new application (<code>v2</code>) image. OpenShift uses a resource called a <em>ReplicaSet</em> to manage these two sets (old replicas and new replicas).</p>
<hr />
<ol start="68">
<li>To see the <code>mypyflask</code> application <em>ReplicaSets</em>, execute the following instruction within the Terminal console:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>oc get replicasets -l <span class="nv">app</span><span class="o">=</span>mypyflask
</code></pre></div>
<p>The number of <code>DESIRED</code>, <code>CURRENT</code>, and <code>READY</code> <em>ReplicaSets</em> for the application should each display <code>5</code>.</p>
<hr />
<ol start="69">
<li>Undo the results of the previous (<code>v2</code>) update by using a <em>rollout</em> instruction set:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>oc rollout undo deployment/mypyflask
</code></pre></div>
<hr />
<ol start="70">
<li>Use the <code>status</code> command to check the details of the deployment now that the earlier changes have rolled back:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>oc rollout status deployment/mypyflask
</code></pre></div>
<hr />
<ol start="71">
<li>Get a list of the newly-created pods:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>oc get pods
</code></pre></div>
<p>If you perform this step quickly after executing the instruction on Step 69, you'll likely see a mixture of <em>Running</em> and <em>Terminating</em> pods. After a few moments, the <em>Terminating</em> pods will be destroyed and only the <em>Running</em> (rolled back) pods will remain.</p>
<hr />
<ol start="72">
<li>As you did previously in Step 66, use the <code>describe</code> command (and the name of one of the pods from Step 71) to verify that the <code>version</code> of the application has rolled back to <code>v1</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>oc describe pod &lt;pod-name&gt;
</code></pre></div>
<p>Replace <code>&lt;pod-name&gt;</code> with the name of the pod recorded in Step 71. Do not include the <code>&lt; &gt;</code> braces when executing the modified instruction.</p>
<hr />
<ol start="73">
<li>Repeat your inspection of the <em>ReplicaSets</em> that was first performed in Step 68:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>oc get replicasets -l <span class="nv">app</span><span class="o">=</span>mypyflask
</code></pre></div>
<p>Notice that there’s still two sets of <em>ReplicaSets</em>: the <em>old</em> replicas and the <em>new</em> replicas. And as before, the number of <code>DESIRED</code>, <code>CURRENT</code>, and <code>READY</code> sets are equal to <code>5</code>.</p>
<p>However, the <code>ACTIVE</code> sets (where the value is <code>5</code>) have now been assigned to the list <em>old</em> replica sets — as opposed to previously in Step 68, where they belonged to the <em>new</em> replica sets. This confirms that the old <em>ReplicaSet</em> list is now active and managing 5 different pod replicas.</p>
<hr />
<ol start="74">
<li>Return to the <strong>Route Details</strong> panel on the OpenShift web dashboard (Step 59) and click the <em>URL</em> under the <em>Location</em> category. This will launch a new browser window, which should display the <code>v1</code> version of <code>mypyflask</code> once again. This confirms that the rollback operation was a success.</li>
</ol>
<hr />
<p>Well done! You’ve succeeded in managing Amy's app programmatically via Red Hat OpenShift on Power. That concludes the hands-on components to this Level 3 course.</p>
<p>You are encouraged at this stage to complete your <a href="https://ibm.github.io/OCP-Modernize-CIO-L3/evaluation/" target="_blank">Level 3 accreditation</a> (requirements vary depending on your job role).</p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../moduleB/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Module B - Working graphically with OpenShift" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Module B - Working graphically with OpenShift
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 IBM
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "content.code.annotate"], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>